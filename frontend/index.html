<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Tourneys</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="bg-white p-6 rounded-xl shadow-md w-96">
    <h1 class="text-2xl font-bold mb-4">Signup / Login</h1>
    <form id="signupForm" class="space-y-3">
      <input name="name" placeholder="Name" class="w-full border p-2 rounded">
      <input name="organisation_name" placeholder="Organisation Name" class="w-full border p-2 rounded">
      <input name="whatsapp_number" placeholder="WhatsApp Number" class="w-full border p-2 rounded">
      <input name="org_insta_page" placeholder="Instagram Page" class="w-full border p-2 rounded">
      <input name="whatsapp_channel" placeholder="WhatsApp Channel" class="w-full border p-2 rounded">
      <input name="email" type="email" placeholder="Email" class="w-full border p-2 rounded">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Send OTP</button>
    </form>

    <div id="otpSection" class="hidden mt-4">
      <input id="otpInput" placeholder="Enter OTP" class="w-full border p-2 rounded mb-2">
      <button onclick="verifyOTP()" class="bg-green-500 text-white px-4 py-2 rounded w-full">Verify OTP</button>
    </div>
  </div>

<script>
const API_BASE = "http://localhost:8000/auth";

document.getElementById("signupForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = Object.fromEntries(new FormData(e.target).entries());
  const res = await fetch(`${API_BASE}/signup/`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(formData)
  });
  if(res.ok){
    alert("OTP sent!");
    document.getElementById("otpSection").classList.remove("hidden");
  } else {
    alert("Signup failed");
  }
});

async function verifyOTP(){
  const email = document.querySelector("input[name='email']").value;
  const otp = document.getElementById("otpInput").value;
  const res = await fetch(`${API_BASE}/verify-otp/`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({email, otp})
  });
  const data = await res.json();
  if(res.ok){
    localStorage.setItem("access", data.tokens.access);
    localStorage.setItem("refresh", data.tokens.refresh);
    alert("Login success!");
  } else {
    alert(data.error);
  }
}
</script>
</body>
</html>
